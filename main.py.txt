import os
import logging
from telebot import TeleBot, types

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Railway
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

BOT_TOKEN = os.environ['TELEGRAM_BOT_TOKEN']
ADMIN_ID = os.environ.get('ADMIN_ID', 'Mr_Scrooge_1986')

bot = TeleBot(BOT_TOKEN)

print("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Å–∏—Ö–æ–ª–æ–≥-–±–æ—Ç–∞...")

class PsychologyBot:
    def __init__(self):
        self.responses = {
            'crisis': "üö® –í–∞—à–∞ –∂–∏–∑–Ω—å –≤–∞–∂–Ω–∞! –¢–µ–ª–µ—Ñ–æ–Ω –¥–æ–≤–µ—Ä–∏—è: 8-800-2000-122",
            'anxiety': "–ü–æ–Ω–∏–º–∞—é —Ç—Ä–µ–≤–æ–≥—É. –î—ã—à–∏—Ç–µ –≥–ª—É–±–æ–∫–æ: –≤–¥–æ—Ö 4 —Å–µ–∫, –ø–∞—É–∑–∞ 4, –≤—ã–¥–æ—Ö 6. –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç?",
            'depression': "–ß—É–≤—Å—Ç–≤–æ –ø–æ–¥–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç–∏ —Ç—è–∂–µ–ª–æ. –ß—Ç–æ –æ–±—ã—á–Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç –≤–∞–º?",
            'relationships': "–û—Ç–Ω–æ—à–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ '–Ø-—Å–æ–æ–±—â–µ–Ω–∏—è' –¥–ª—è –≤—ã—Ä–∞–∂–µ–Ω–∏—è —á—É–≤—Å—Ç–≤.",
            'default': "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –¥–µ–ª–∏—Ç–µ—Å—å. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–∞—à–∏—Ö –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è—Ö?"
        }
    
    def get_response(self, message):
        msg_lower = message.lower()
        
        if any(word in msg_lower for word in ['—Å—É–∏—Ü–∏–¥', '—Å–∞–º–æ—É–±–∏–π—Å—Ç–≤–æ', '–ø–æ–∫–æ–Ω—á–∏—Ç—å']):
            return self.responses['crisis']
        elif any(word in msg_lower for word in ['—Ç—Ä–µ–≤–æ–∂', '—Å—Ç—Ä–∞—Ö', '–±–æ—é—Å—å', '–ø–∞–Ω–∏–∫']):
            return self.responses['anxiety']
        elif any(word in msg_lower for word in ['–≥—Ä—É—Å—Ç–Ω–æ', '–ø–æ–¥–∞–≤–ª–µ–Ω', '–¥–µ–ø—Ä–µ—Å—Å–∏', '—Ç–æ—Å–∫']):
            return self.responses['depression']
        elif any(word in msg_lower for word in ['–æ—Ç–Ω–æ—à–µ–Ω', '–ø–∞—Ä–µ–Ω—å', '–¥–µ–≤—É—à–∫–∞', '—Å–µ–º—å']):
            return self.responses['relationships']
        else:
            return self.responses['default']

psych_bot = PsychologyBot()

@bot.message_handler(commands=['start'])
def send_welcome(message):
    text = """üß† –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É!

–Ø –≤–∞—à AI-–ø—Å–∏—Ö–æ–ª–æ–≥. –ì–æ—Ç–æ–≤ –≤—ã—Å–ª—É—à–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å.

–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –æ —Ç–æ–º, —á—Ç–æ –≤–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç..."""
    
    bot.send_message(message.chat.id, text)
    print(f"üë§ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {message.from_user.username}")

@bot.message_handler(commands=['help'])
def send_help(message):
    help_text = """üí´ –Ø –∑–¥–µ—Å—å —á—Ç–æ–±—ã:
‚Ä¢ –í—ã—Å–ª—É—à–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å
‚Ä¢ –ü–æ–º–æ—á—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —á—É–≤—Å—Ç–≤–∞—Ö
‚Ä¢ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç–µ—Ö–Ω–∏–∫–∏ —Å–∞–º–æ–ø–æ–º–æ—â–∏

–ù–∞–ø–∏—à–∏—Ç–µ –æ —Å–≤–æ–∏—Ö –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è—Ö - —è –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å!"""
    
    bot.send_message(message.chat.id, help_text)

@bot.message_handler(func=lambda message: True)
def handle_message(message):
    print(f"üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {message.from_user.username}: {message.text}")
    response = psych_bot.get_response(message.text)
    bot.send_message(message.chat.id, response)

if __name__ == "__main__":
    print("‚úÖ –ë–æ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
    print("ü§ñ –ó–∞–ø—É—Å–∫–∞—é –ø–æ–ª–ª–∏–Ω–≥...")
    
    try:
        bot.infinity_polling()
    except Exception as e:
        print(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")